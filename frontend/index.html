<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gradwork API Demo</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,sans-serif;padding:20px;background:#f5f5f5}
h1{margin-bottom:10px}
.auth-bar{background:#fff;padding:15px;border-radius:8px;margin-bottom:20px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.auth-bar input{flex:1;min-width:200px;padding:8px;border:1px solid #ccc;border-radius:4px;font-size:14px}
.auth-bar button{padding:8px 16px}
.tabs{display:flex;gap:5px;margin-bottom:15px}
.tabs button{padding:8px 18px;border:1px solid #ccc;background:#fff;border-radius:4px 4px 0 0;cursor:pointer}
.tabs button.active{background:#333;color:#fff;border-color:#333}
.panel{display:none;background:#fff;padding:20px;border-radius:0 8px 8px 8px}
.panel.active{display:block}
.actions{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}
button{padding:6px 14px;border:1px solid #999;border-radius:4px;cursor:pointer;background:#fff}
button:hover{background:#eee}
button.primary{background:#333;color:#fff;border-color:#333}
.form-row{display:flex;gap:8px;margin-bottom:8px;align-items:center;flex-wrap:wrap}
.form-row label{width:120px;font-weight:600;font-size:14px}
.form-row input,.form-row select{padding:6px;border:1px solid #ccc;border-radius:4px;font-size:14px;width:250px}
pre{background:#1e1e1e;color:#d4d4d4;padding:15px;border-radius:6px;overflow:auto;max-height:400px;margin-top:15px;font-size:13px;white-space:pre-wrap}
.status{padding:6px 12px;border-radius:4px;font-size:13px;font-weight:600;display:inline-block;margin-bottom:10px}
.status.ok{background:#d4edda;color:#155724}
.status.err{background:#f8d7da;color:#721c24}
.status.info{background:#d1ecf1;color:#0c5460}
#user-info{font-size:13px;color:#555}
</style>
</head>
<body>
<h1>üéì Gradwork API Demo</h1>

<div class="auth-bar">
  <label><strong>Supabase JWT:</strong></label>
  <input id="token" type="password" placeholder="Paste your Supabase access_token here">
  <button class="primary" onclick="testAuth()">Test Auth (GET /me)</button>
  <span id="user-info"></span>
</div>

<div class="tabs">
  <button class="active" onclick="showTab('users')">Users</button>
  <button onclick="showTab('portfolios')">Portfolios</button>
  <button onclick="showTab('gigs')">Gigs</button>
</div>

<!-- USERS -->
<div id="tab-users" class="panel active">
  <h2>Users</h2>
  <div class="actions">
    <button class="primary" onclick="api('GET','/api/users')">List All</button>
    <input id="user-id" placeholder="User UUID" style="padding:6px;width:300px;border:1px solid #ccc;border-radius:4px">
    <button onclick="api('GET','/api/users/'+v('user-id'))">Get by ID</button>
    <button onclick="api('DELETE','/api/users/'+v('user-id'))">Delete</button>
  </div>
  <h3>Update User</h3>
  <div class="form-row"><label>ID</label><input id="uu-id" placeholder="UUID (required)"></div>
  <div class="form-row"><label>Email</label><input id="uu-email" placeholder="optional"></div>
  <div class="form-row"><label>Username</label><input id="uu-username" placeholder="optional"></div>
  <div class="form-row"><label>Display Name</label><input id="uu-display" placeholder="optional"></div>
  <div class="form-row"><label>Avatar URL</label><input id="uu-avatar" placeholder="optional"></div>
  <div class="form-row"><label>Role</label><select id="uu-role"><option value="">--</option><option>client</option><option>freelancer</option><option>admin</option></select></div>
  <button class="primary" onclick="updateUser()" style="margin-top:8px">PUT Update</button>
</div>

<!-- PORTFOLIOS -->
<div id="tab-portfolios" class="panel">
  <h2>Portfolios</h2>
  <div class="actions">
    <button class="primary" onclick="api('GET','/api/portfolios')">List All</button>
    <input id="port-id" placeholder="Portfolio UUID" style="padding:6px;width:300px;border:1px solid #ccc;border-radius:4px">
    <button onclick="api('GET','/api/portfolios/'+v('port-id'))">Get by ID</button>
    <button onclick="api('DELETE','/api/portfolios/'+v('port-id'))">Delete</button>
  </div>
  <div class="actions">
    <input id="port-fid" placeholder="Freelancer UUID" style="padding:6px;width:300px;border:1px solid #ccc;border-radius:4px">
    <button onclick="api('GET','/api/portfolios/freelancer/'+v('port-fid'))">Get by Freelancer</button>
  </div>
  <h3>Create Portfolio</h3>
  <div class="form-row"><label>Title</label><input id="pc-title"></div>
  <div class="form-row"><label>Description</label><input id="pc-desc"></div>
  <div class="form-row"><label>Freelancer ID</label><input id="pc-fid"></div>
  <div class="form-row"><label>Price</label><input id="pc-price" type="number" step="0.01"></div>
  <button class="primary" onclick="createPortfolio()" style="margin-top:8px">POST Create</button>

  <h3 style="margin-top:15px">Update Portfolio</h3>
  <div class="form-row"><label>ID</label><input id="pu-id" placeholder="UUID (required)"></div>
  <div class="form-row"><label>Title</label><input id="pu-title" placeholder="optional"></div>
  <div class="form-row"><label>Description</label><input id="pu-desc" placeholder="optional"></div>
  <div class="form-row"><label>Price</label><input id="pu-price" type="number" step="0.01" placeholder="optional"></div>
  <button class="primary" onclick="updatePortfolio()" style="margin-top:8px">PUT Update</button>
</div>

<!-- GIGS -->
<div id="tab-gigs" class="panel">
  <h2>Gigs</h2>
  <div class="actions">
    <button class="primary" onclick="api('GET','/api/gigs')">List All</button>
    <input id="gig-id" placeholder="Gig UUID" style="padding:6px;width:300px;border:1px solid #ccc;border-radius:4px">
    <button onclick="api('GET','/api/gigs/'+v('gig-id'))">Get by ID</button>
    <button onclick="api('DELETE','/api/gigs/'+v('gig-id'))">Delete</button>
  </div>
  <h3>Create Gig</h3>
  <div class="form-row"><label>Title</label><input id="gc-title"></div>
  <div class="form-row"><label>Description</label><input id="gc-desc"></div>
  <div class="form-row"><label>Price</label><input id="gc-price" type="number" step="0.01"></div>
  <button class="primary" onclick="createGig()" style="margin-top:8px">POST Create</button>

  <h3 style="margin-top:15px">Update Gig</h3>
  <div class="form-row"><label>ID</label><input id="gu-id" placeholder="UUID (required)"></div>
  <div class="form-row"><label>Title</label><input id="gu-title" placeholder="optional"></div>
  <div class="form-row"><label>Description</label><input id="gu-desc" placeholder="optional"></div>
  <div class="form-row"><label>Price</label><input id="gu-price" type="number" step="0.01" placeholder="optional"></div>
  <button class="primary" onclick="updateGig()" style="margin-top:8px">PUT Update</button>
</div>

<div id="output"></div>

<script>
const BASE='';
const v=id=>document.getElementById(id).value.trim();
const token=()=>v('token');

function showTab(name){
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelector(`.tabs button[onclick*="${name}"]`).classList.add('active');
  document.getElementById('tab-'+name).classList.add('active');
}

async function api(method,path,body){
  const out=document.getElementById('output');
  if(!token()){out.innerHTML='<div class="status err">‚ö† Paste a JWT token first</div>';return;}
  const opts={method,headers:{'Authorization':'Bearer '+token(),'Content-Type':'application/json'}};
  if(body)opts.body=JSON.stringify(body);
  out.innerHTML='<div class="status info">‚è≥ '+method+' '+path+'</div>';
  try{
    const r=await fetch(BASE+path,opts);
    const data=await r.json();
    const cls=r.ok?'ok':'err';
    out.innerHTML='<div class="status '+cls+'">'+r.status+' '+r.statusText+'</div><pre>'+JSON.stringify(data,null,2)+'</pre>';
  }catch(e){
    out.innerHTML='<div class="status err">Network error: '+e.message+'</div>';
  }
}

function testAuth(){api('GET','/api/auth/me');}

function opt(val){return val||undefined;}
function optNum(val){return val?parseFloat(val):undefined;}

function updateUser(){
  const body={};
  if(v('uu-email'))body.email=v('uu-email');
  if(v('uu-username'))body.username=v('uu-username');
  if(v('uu-display'))body.display_name=v('uu-display');
  if(v('uu-avatar'))body.avatar_url=v('uu-avatar');
  if(v('uu-role'))body.role=v('uu-role');
  api('PUT','/api/users/'+v('uu-id'),body);
}
function createPortfolio(){
  api('POST','/api/portfolios',{title:v('pc-title'),description:v('pc-desc'),freelancer_id:v('pc-fid'),price:parseFloat(v('pc-price'))});
}
function updatePortfolio(){
  const body={};
  if(v('pu-title'))body.title=v('pu-title');
  if(v('pu-desc'))body.description=v('pu-desc');
  if(v('pu-price'))body.price=parseFloat(v('pu-price'));
  api('PUT','/api/portfolios/'+v('pu-id'),body);
}
function createGig(){
  api('POST','/api/gigs',{title:v('gc-title'),description:v('gc-desc'),price:parseFloat(v('gc-price'))});
}
function updateGig(){
  const body={};
  if(v('gu-title'))body.title=v('gu-title');
  if(v('gu-desc'))body.description=v('gu-desc');
  if(v('gu-price'))body.price=parseFloat(v('gu-price'));
  api('PUT','/api/gigs/'+v('gu-id'),body);
}
</script>
</body>
</html>
